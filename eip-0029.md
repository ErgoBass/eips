# Transaction purpose field

* Author: MrStahlfelge
* Status: Proposed
* Created: 18-Feb-2022
* License: CC0
* Forking: not needed 

## Motivation 

Most payment systems provide a way to set a "purpose" field, used to display a short message
from payment issuers to payment receivers.

This EIP describes how one of the optional registers of Ergo boxes can be used to store a purpose
message.
This message can be set by wallet applications and dApps and can be shown by Ergo Explorer and
Wallet applications.


## Ergo boxes background

A box can contain up to nine registers. Registers 1 to 3 are reserved and mandatory, registers 4
to 9 are optional and can be used as input for scripts or are used for token minting (see EIP-4).

Registers must be densely packed. It is not possible to use register 9 without adding register 4
to 8.

A box cannot be more than 4 kbytes.

## Ergo purpose message standard

Ergo boxes can hold Coll[Byte] that can be a UTF-8 representation of the purpose field.
However, this would mean that we must designate a certain register to be used as purpose register,
and because of the restrictions mentioned above this would mean to use R4, blocking it for all
other use cases. This is not desired.

To overcome this, we define that the purpose is encoded as follows in an arbitrary box:

`Pair([0x50, 0x52, 0x50], Coll[Byte])`

This is a pair of a constant Coll[Byte] used to identify this register as a purpose message
register, and the actual purpose message as Coll[Byte] (UTF-8 representation).
This means that, in hex representation, the purpose register always starts with a constant prefix
of `3c0e0e0350525`.

The first register identified as a purpose message register can be used to read a purpose message
for this box. If there is no such register on a box, no purpose message is defined.

#### Examples

| Purpose message         | Register hex representation                                        |
| ----------------------- |:------------------------------------------------------------------:|
| "Your loan January"     | 3c0e0e0350525011596f7572206c6f616e204a616e75617279                 |
| "Order NFT #32"         | 3c0e0e035052500d4f72646572204e465420233332                         |
| "✈️ Ticket Oceanic 847" | 3c0e0e0350525019e29c88efb88f205469636b6574204f6365616e696320383437 |


As described, the purpose message is stored in a register of a box. A transaction can have multiple
outgoing boxes, hence it can have multiple purpose messages. This is desired behaviour: in Ergo's
UTXO model, a single transaction can be used to send ERG and tokens to multiple recipients. Using
this design, every recipient's box can have an own purpose message.

### Issuing applications

dApps and wallet applications using the purpose message feature should make their users aware of the
fact that the purpose message is public for everyone and can't be deleted. The applications should
restrict the size of the message.